<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Animation of historical shorelines</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v2.9.2/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.9.2/mapbox-gl.js"></script>
<style>
    body { 
          margin: 0;
          padding: 0; 
        }

    #map {
          position:absolute;
          top: 0;
          bottom: 0;
          /*left: 0;
          right: 0; */
          width: 100%; 
        }

    button {
        position: absolute;
        top: 15px;
        right: 15px;
        background-color: firebrick;
        color: white;
        font-size: large;
        z-index: 9999;
    }

    label {
        display: block;
        border-bottom: 1px solid rgba(0, 0, 0, 0.25);
        font-weight: bold;
        font-size: small;
        margin: 0 0 0px;
    }

    .top-left {
        font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
        position: absolute;
        width: 35%;
        top: 0;
        left: 0;
        padding: 10px;
        background-color: #fff;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        border-radius: 3px;
        
        margin-bottom: 10px;
    }

    .top-left h3 {
        font-size: 20px;
        font-weight: bold;
    }

    .top-left label {
        font-size: 16px;
        font-weight: bold;
    }

    .top-left input {
        background-color: transparent;
        display: inline-block;
        width: 100%;
        position: relative;
        margin: 0;
        cursor: ew-resize;
    }

    #yearHolder {
        position: absolute;
        right: 220px;
        bottom: 20px;
        color:black;
        background-color: white;
        font-size: xx-large;
        z-index: 9999;
    }

    #menu {
        background: #fff;
        position: absolute;
        z-index: 1;
        top: 135px;
        right: 10px;
        border-radius: 3px;
        width: 160px;
        border: 1px solid rgba(0, 0, 0, 0.4);
        font-family: 'Open Sans', sans-serif;
    }
 
    #menu a {
        font-size: 13px;
        color: #404040;
        display: block;
        margin: 0;
        padding: 0;
        padding: 10px;
        text-decoration: none;
        border-bottom: 1px solid rgba(0, 0, 0, 0.25);
        text-align: center;
    }

    
 
    #menu a:last-child {
        border: none;
    }
 
    #menu a:hover {
        background-color: #f8f8f8;
        color: #404040;
    }
 
    #menu a.active {
        background-color: #3887be;
        color: #ffffff;
    }

    #menu a.active:hover {
        background: #3074a4;
    }

</style>

</head>

<body>
    <div id="map"></div>
    <button id="play">Click to play animation</button>
    <div id="yearHolder"></div>
    <nav id="menu">
        <label>Surveyed Year to Display</label>
    </nav>
    <div class="top-left">
        <h3>Shoreline Animation Year</h3>
        <label id="slideryear"></label>
        <input id="slider" type="range" min="1700" max="1911" step="1" value="1700">
    </div>

    <script>
        
        // coordinates to show the visualized year
        const coordinatesYear=[-124.083646,46.890852];

        // create a dictionary to store all the geojson objects
        let yearObjects = {};

        for (let i = 1700; i < 2000; i++) {
            yearObjects['year' + i] = {
                'type': 'FeatureCollection',
                'features': [
                    {
                        'type': 'Feature',
                        'geometry': {
                            'type': 'Point',
                            'coordinates': coordinatesYear
                        },
                        'properties': {
                            'description': i.toString()
                        }
                    }, 
                ]
            };
        }

        // Now you can access the GeoJSON objects like this:
        //console.log(geojsonObjects.geojson0);
        //console.log(geojsonObjects.geojson1);
        // etc.


        const shorelineColor = '#0000FF';   //blue

        const textSize = 30;

        //wnumerate the years from 1700 to 1911
        let all_years = [];
        for (let i=1700; i<1912; i++) {
            
            all_years.push(i);
            
        };

        mapboxgl.accessToken = 'pk.eyJ1IjoiemxpdTk2IiwiYSI6ImNsMnI3ZWNkcDA0bmwzYnFzcmxnbG9rejMifQ.KS1NO7CgxL3hJi94lTgidQ';

        const map = new mapboxgl.Map({
         container: 'map', // container ID
         style: 'mapbox://styles/mapbox/light-v11', // style URL
         zoom: 11, // starting zoom
         center: [-124.0572, 46.8159] // starting center
        }); 

        const nav = new mapboxgl.NavigationControl();
        map.addControl(nav, 'top-left');

        const year_surveyed = [1700, 1860, 1911, 1926];

        map.on('load',() => {

            let current = 0;
            // this for loop is to load yearholders on the map
            for (let i=1700;i<1912; i++) {
                map.addSource('yeardisplay'+i, {
                    'type': 'geojson',
                    'data': yearObjects['year'+i]
                });

                map.addLayer({
                    'id': 'yeardisplay'+i,
                    'type': 'symbol',
                    'source': 'yeardisplay'+i,
                    'layout':{
                            'text-field': ['get', 'description'],
                            'text-variable-anchor': ['top', 'bottom', 'left', 'right'],
                            'text-radial-offset': 0.5,
                            'text-justify': 'auto',
                            'text-size':textSize,
                            'visibility':'none'
                        },
                        'paint':{
                            'text-color': "#FFFFFF"
                        }
                });

                //continue to add sources of shorelines
                //write a if statement to determine whether the i is between 1700 and 1860
                if (i>=1700 && i<=1860) {
                    map.addSource('shoreline'+i, {
                        'type': 'geojson',
                        'data': 'assets/ECY_estimated_shorelines/'+i+'_Jun27.geojson'
                    });

                    map.addLayer({
                        'id': 'shoreline'+i+'layer1',
                        'type': 'line',
                        'source': 'shoreline'+i,
                        'filter': ['==', ['get', 'layer'], 'layer1'],
                        'layout':{
                            'visibility':'none'
                        },
                        'paint':{
                            'line-color': shorelineColor,
                            'line-width': 3
                        }
                        });

                    if (i != 1700) {
                        map.addLayer({
                            'id': 'shoreline'+i+'layer2',
                            'type': 'line',
                            'source': 'shoreline'+i,
                            'filter': ['==', ['get', 'layer'], 'layer2'],
                            'layout':{
                                'visibility':'none'
                            },
                            'paint':{
                                'line-color': shorelineColor,
                                'line-width': 3,
                                'line-dasharray': [4,4]
                        }
                        });
                    }

                    if (i != 1860) {
                        map.addLayer({
                            'id': 'shoreline'+i+'layer3',
                            'type': 'line',
                            'source': 'shoreline'+i,
                            'filter': ['==', ['get', 'layer'], 'layer3'],
                            'layout':{
                                'visibility':'none'
                            },
                            'paint':{
                                'line-color': shorelineColor,
                                'line-width': 3,
                                'line-dasharray': [4,4],
                                'line-blur': 3
                            }
                        });
                    }
                } else if (i>1860 && i<=1910) {
                        map.addSource('shoreline'+i, {
                            'type': 'geojson',
                            'data': 'assets/ECY_estimated_shorelines/'+i+'_Jun29.geojson'
                        });

                        map.addLayer({
                            'id': 'shoreline'+i+'layer1',
                            'type': 'line',
                            'source': 'shoreline'+i,
                            'filter': ['==', ['get', 'layer'], 'layer1'],
                            'layout':{
                                'visibility':'none'
                            },
                            'paint':{
                                'line-color': shorelineColor,
                                'line-width': 3,
                                'line-dasharray': [4,4],
                                'line-blur': 3
                            }
                        });

                        map.addLayer({
                            'id': 'shoreline'+i+'layer2',
                            'type': 'line',
                            'source': 'shoreline'+i,
                            'filter': ['==', ['get', 'layer'], 'layer2'],
                            'layout':{
                                'visibility':'none'
                            },
                            'paint':{
                                'line-color': shorelineColor,
                                'line-width': 3,
                                'line-dasharray': [4,4]
                            }
                        });
                    } else if (i==1911) {
                    
                        map.addSource('shoreline'+i, {
                            'type': 'geojson',
                            'data': 'assets/ECY_estimated_shorelines/1911_Jun28.geojson'
                        });

                        map.addLayer({
                            'id': 'shoreline'+i+'layer1',
                            'type': 'line',
                            'source': 'shoreline'+i,
                            'filter': ['==', ['get', 'layer'], 'layer1'],
                            'layout':{
                                'visibility':'none'
                            },
                            'paint':{
                                'line-color': shorelineColor,
                                'line-width': 3,
                            }
                        });

                        map.addLayer({
                            'id': 'shoreline'+i+'layer2',
                            'type': 'line',
                            'source': 'shoreline'+i,
                            'filter': ['==', ['get', 'layer'], 'layer2'],
                            'layout':{
                                'visibility':'none'
                            },
                            'paint':{
                                'line-color': shorelineColor,
                                'line-width': 3,
                                'line-dasharray': [4,4]
                            }
                            });
                    }

            };

            //add shoreline data of 1926 available from WA ECY
            map.addSource('shoreline1926',{
                'type':"geojson",
                'data':'assets/ECY_historical_shorelines_epsg32149/1926.geojson'
            });

            map.addLayer({
                'id':'shoreline1926',
                'type':'line',
                'source': 'shoreline1926',
                'layout':{
                    'visibility':'none'
                },
                'paint':{
                    'line-color': shorelineColor,
                    'line-width': 3,
                }
            });

            //add shoreline data of 1942 available from WA ECY
            map.addSource('shoreline1942',{
                'type':"geojson",
                'data':'assets/ECY_historical_shorelines_epsg32149/1942.geojson'
            });

            map.addLayer({
                'id':'shoreline1942',
                'type':'line',
                'source': 'shoreline1942',
                'layout':{
                    'visibility':'none'
                },
                'paint':{
                    'line-color': shorelineColor,
                    'line-width': 3,
                }
            });

            //add shoreline data of 1954 available from WA ECY
            map.addSource('shoreline1954',{
                'type':"geojson",
                'data':'assets/ECY_historical_shorelines_epsg32149/1954.geojson'
            });

            map.addLayer({
                'id':'shoreline1954',
                'type':'line',
                'source': 'shoreline1954',
                'layout':{
                    'visibility':'none'
                },
                'paint':{
                    'line-color': shorelineColor,
                    'line-width': 3,
                }
            });

            //add shoreline data of 1967 available from WA ECY
            map.addSource('shoreline1967',{
                'type':"geojson",
                'data':'assets/ECY_historical_shorelines_epsg32149/1967.geojson'
            });

            map.addLayer({
                'id':'shoreline1967',
                'type':'line',
                'source': 'shoreline1967',
                'layout':{
                    'visibility':'none'
                },
                'paint':{
                    'line-color': shorelineColor,
                    'line-width': 3,
                }
            });

            //add shoreline data of 1974 available from WA ECY
            map.addSource('shoreline1974',{
                'type':"geojson",
                'data':'assets/ECY_historical_shorelines_epsg32149/1974.geojson'
            });

            map.addLayer({
                'id':'shoreline1974',
                'type':'line',
                'source': 'shoreline1974',
                'layout':{
                    'visibility':'none'
                },
                'paint':{
                    'line-color': shorelineColor,
                    'line-width': 3,
                }
            });

            //add shoreline data of 1986 available from WA ECY
            map.addSource('shoreline1986',{
                'type':"geojson",
                'data':'assets/ECY_historical_shorelines_epsg32149/1986.geojson'
            });

            map.addLayer({
                'id':'shoreline1986',
                'type':'line',
                'source': 'shoreline1986',
                'layout':{
                    'visibility':'none'
                },
                'paint':{
                    'line-color': shorelineColor,
                    'line-width': 3,
                }
            });

            // default setting: when users open the page, the map will show the shoreline of 1700
            map.setLayoutProperty(
                'shoreline1700layer1',
                'visibility',
                'visible'
            );

            map.setLayoutProperty(
                'yeardisplay1700',
                'visibility',
                'visible'
            );

            map.setLayoutProperty(
                'shoreline1700layer3',
                'visibility',
                'visible'
            );

            //function to set the animation
            function myFunction () {
                myInt = setInterval(() => {
                    if (current == 0) {
                        previous = all_years.length-1;
                    };
                    
                    map.setLayoutProperty(
                        `shoreline${all_years[current]}layer1`,
                        'visibility',
                        'visible'
                    );

                    map.setLayoutProperty(
                        `shoreline${all_years[previous]}layer1`,
                        'visibility',
                        'none'
                    );

                    current_year = all_years[current];
                    previous_year = all_years[previous];

                    map.setLayoutProperty(
                        `yeardisplay${current_year}`,
                        'visibility',
                        'visible'
                    );

                    map.setLayoutProperty(
                        `yeardisplay${previous_year}`,
                        'visibility',
                        'none'
                    );


                    if (current_year != 1700) {
                        map.setLayoutProperty(
                            `shoreline${current_year}layer2`,
                            'visibility',
                            'visible'
                        );
                    };

                    if (previous_year != 1700) {
                        map.setLayoutProperty(
                            `shoreline${previous_year}layer2`,
                            'visibility',
                            'none'
                        );
                    };

                    if (current_year >= 1700 && current_year <= 1859) {
                        map.setLayoutProperty(
                            `shoreline${current_year}layer3`,
                            'visibility',
                            'visible'
                        );
                    };

                    if (previous_year >= 1700 && previous_year <= 1859) {
                        map.setLayoutProperty(
                            `shoreline${previous_year}layer3`,
                            'visibility',
                            'none'
                        );
                    };

                    //show the year on at the bottom right
                    document.getElementById("yearHolder").innerHTML = all_years[current].toString();

                    document.getElementById('slider').value = current_year;

                    document.getElementById('slideryear').textContent = current_year.toString();


                    previous = current;
                    current += 1;

                    if (current > all_years.length-1) {
                        current = 0;
                        };


                },300)
            };

            //this function stops the animation
            function myStopInterval() {
                clearInterval(myInt);
            };

            document.getElementById("play").addEventListener("click", function () {
                if (document.getElementById("play").innerText=="Click to play animation") {
                    myFunction();
                    document.getElementById("play").innerText="Click to pause";

                } else {
                    myStopInterval();
                    document.getElementById("play").innerText="Click to play animation";
                }
            
            });
                // If these layers were not added to the map, abort
            if ( !map.getLayer('shoreline1700layer1') || !map.getLayer('shoreline1700layer3') || !map.getLayer('shoreline1860layer1') || !map.getLayer('shoreline1860layer2')|| !map.getLayer('shoreline1911layer1') || !map.getLayer('shoreline1911layer2')) {
            return;
            }

//set the slider of layer toggle
            document.getElementById('slideryear').textContent = "1700";

            document.getElementById('slider').addEventListener('input', (e) => {
                if (document.getElementById("play").innerText=="Click to pause") {
                    myStopInterval();
                    document.getElementById("play").innerText="Click to play animation";
                };
                //document.getElementById("play").innerText="Click to play animation";

                const sdyear = parseInt(e.target.value,10);

                //get the index of the year in the all_years array
                current = all_years.indexOf(sdyear);

                document.getElementById('slideryear').textContent = sdyear.toString();
                for (let i=1700; i<1912; i++) {
                    if (i==sdyear) {
                        map.setLayoutProperty(
                            `shoreline${i}layer1`,
                            'visibility',
                            'visible'
                        );
                        map.setLayoutProperty(
                            `yeardisplay${i}`,
                            'visibility',
                            'visible'
                        );
                        if (i != 1700) {
                            map.setLayoutProperty(
                                `shoreline${i}layer2`,
                                'visibility',
                                'visible'
                            );
                        };
                        if (i >= 1700 && i <= 1859) {
                            map.setLayoutProperty(
                                `shoreline${i}layer3`,
                                'visibility',
                                'visible'
                            );
                        };
                    } else {
                        map.setLayoutProperty(
                            `shoreline${i}layer1`,
                            'visibility',
                            'none'
                        );
                        map.setLayoutProperty(
                            `yeardisplay${i}`,
                            'visibility',
                            'none'
                        );
                        if (i != 1700) {
                            map.setLayoutProperty(
                                `shoreline${i}layer2`,
                                'visibility',
                                'none'
                            );
                        };
                        if (i >= 1700 && i <= 1859) {
                            map.setLayoutProperty(
                                `shoreline${i}layer3`,
                                'visibility',
                                'none'
                            );
                        };
                    }
                }
            });
//end of slider setting

//set the menu of layer toggle to show surveyed years
            // Enumerate ids of the layers.
            const toggleableLayerIds = ['1700', '1860','1911','1926'];

            for (const id of toggleableLayerIds) {
                

              
                // Create a link.
                if (id == "1700") {
                    // Skip id that already have a button set up
                    if (document.getElementById(id)) {
                        continue;
                    };
                    const link = document.createElement('a');
                    link.id = id;
                    link.href = '#';
                    link.textContent = id;
                    link.className = '';

                    link.onclick = function (e) {
                        const clickedLayer_1 = "shoreline1700layer1";
                        const clickedLayer_2 = "shoreline1700layer3";
                        e.preventDefault();
                        e.stopPropagation(); 
                        const visibility_1 = map.getLayoutProperty(
                            clickedLayer_1,
                            'visibility'
                        );
                        const visibility_2 = map.getLayoutProperty(
                            clickedLayer_2,
                            'visibility'
                        );
                        // Toggle layer visibility by changing the layout object's visibility property.
                        if (visibility_1 === 'visible') {
                            map.setLayoutProperty(
                                clickedLayer_1,
                                'visibility',
                                'none'
                            );
                            map.setLayoutProperty(
                                clickedLayer_2,
                                'visibility',
                                'none'
                            );
                            this.className = '';
                        } else {
                            this.className = 'active';
                            map.setLayoutProperty(
                                clickedLayer_1,
                                'visibility',
                                'visible'
                            );
                            map.setLayoutProperty(
                                clickedLayer_2,
                                'visibility',
                                'visible'
                            );
                        }
                    };

                    const layers = document.getElementById('menu');
                    layers.appendChild(link);
                };

                if (id=="1860") {
                    // Skip id that already have a button set up
                    if (document.getElementById(id)) {
                        continue;
                    };

                    const link = document.createElement('a');
                    link.id = id;
                    link.href = '#';
                    link.textContent = id;
                    link.className = '';

                    link.onclick = function (e) {
                        const clickedLayer_1 = "shoreline1860layer1";
                        const clickedLayer_2 = "shoreline1860layer2";
                        e.preventDefault();
                        e.stopPropagation();
                        const visibility_1 = map.getLayoutProperty(
                            clickedLayer_1,
                            'visibility'
                        );
                        const visibility_2 = map.getLayoutProperty(
                            clickedLayer_2,
                            'visibility'
                        );
                        // Toggle layer visibility by changing the layout object's visibility property.
                        if (visibility_1 === 'visible') {
                            map.setLayoutProperty(
                                clickedLayer_1,
                                'visibility',
                                'none'
                            );
                            map.setLayoutProperty(
                                clickedLayer_2,
                                'visibility',
                                'none'
                            );
                            this.className = '';
                        } else {
                            this.className = 'active';
                            map.setLayoutProperty(
                                clickedLayer_1,
                                'visibility',
                                'visible'
                            );
                            map.setLayoutProperty(
                                clickedLayer_2,
                                'visibility',
                                'visible'
                            );
                        }
                    };

                    const layers = document.getElementById('menu');
                    layers.appendChild(link);
                };

                if (id=="1911") {
                    // Skip id that already have a button set up
                    if (document.getElementById(id)) {
                        continue;
                    };

                    const link = document.createElement('a');
                    link.id = id;
                    link.href = '#';
                    link.textContent = id;
                    link.className = '';

                    link.onclick = function (e) {

                        const clickedLayer_1 = "shoreline1911layer1";
                        const clickedLayer_2 = "shoreline1911layer2";
                        e.preventDefault();
                        e.stopPropagation();
                        const visibility_1 = map.getLayoutProperty(
                            clickedLayer_1,
                            'visibility'
                        );
                        const visibility_2 = map.getLayoutProperty(
                            clickedLayer_2,
                            'visibility'
                        );
                        // Toggle layer visibility by changing the layout object's visibility property.
                        if (visibility_1 === 'visible') {
                            map.setLayoutProperty(
                                clickedLayer_1,
                                'visibility',
                                'none'
                            );
                            map.setLayoutProperty(
                                clickedLayer_2,
                                'visibility',
                                'none'
                            );
                            this.className = '';
                        } else {
                            this.className = 'active';
                            map.setLayoutProperty(
                                clickedLayer_1,
                                'visibility',
                                'visible'
                            );
                            map.setLayoutProperty(
                                clickedLayer_2,
                                'visibility',
                                'visible'
                            );
                        }
                    };

                    const layers = document.getElementById('menu');
                    layers.appendChild(link);
                    //const clickedLayer = this.textContent;
                    
                };

                if (id=="1926") {
                    // Skip id that already have a button set up
                    if (document.getElementById(id)) {
                        continue;
                    };

                    const link = document.createElement('a');
                    link.id = id;
                    link.href = '#';
                    link.textContent = id;
                    link.className = '';

                    link.onclick = function (e) {

                        const clickedLayer = "shoreline1926";
                        //const clickedLayer_2 = "shoreline1911layer2";
                        e.preventDefault();
                        e.stopPropagation();
                        const visibility = map.getLayoutProperty(
                            clickedLayer,
                            'visibility'
                        );
                        /*const visibility_2 = map.getLayoutProperty(
                            clickedLayer_2,
                            'visibility'
                        );*/
                        // Toggle layer visibility by changing the layout object's visibility property.
                        if (visibility === 'visible') {
                            map.setLayoutProperty(
                                clickedLayer,
                                'visibility',
                                'none'
                            );
                            /*map.setLayoutProperty(
                                clickedLayer_2,
                                'visibility',
                                'none'
                            );*/
                            this.className = '';
                        } else {
                            this.className = 'active';
                            map.setLayoutProperty(
                                clickedLayer,
                                'visibility',
                                'visible'
                            );
                            /*map.setLayoutProperty(
                                clickedLayer_2,
                                'visibility',
                                'visible'
                            );*/
                        }
                    };

                    const layers = document.getElementById('menu');
                    layers.appendChild(link);
                    //const clickedLayer = this.textContent;
                    
                }
            }

                }
            

        );



        
    </script>
</body>